<script src="//maps.google.com/maps/api/js?key=<%=ENV["GMAPS_KEY"]%>"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<div id="welcome-bar" class="bar-style bar-thin add-margin bold-bar">
  <span>Projects List</span>
</div>
AIzaSyBLDKPpoh6XmFyPgsQ829rMPkfEY2_RpYY
<br>
<table class="table">
  <thead>
    <tr>
      <th>Customer</th>
      <th>Ref:</th>
      <th>Added by</th>
      <th>Job type</th>
      <th>Stage</th>
      <th>Quote</th>
      <th>Start date</th>
      <th>Team</th>
      <th>Pif</th>
      <th>Contract</th>
      <th>Handled</th>
      <th>Q sent</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @projects.each do |project| %>
      <tr>
        <td>
          <% if project.user && project.user.customer? %>
            <%= link_to user_path(project.user.id) do %>
              <%= project.user.lastname %>
            <% end %>
          <% else %>
            <%= project.last_name %>
          <% end %>
        </td>
        <td><%= project.reference %></td>
        <td><%= project.added_by %></td>
        <td><%= project.job_type %></td>
        <td><%= project.stage %></td>
        <td><%= project.quote %></td>
        <td><%= project.start_date %></td>
        <td><%= project.team.team_no if project.team %></td>
        <td><%= project.pif %></td>
        <td><%= project.contract %></td>
        <td><%= project.handled %></td>
        <td><%= project.q_sent %></td>
        <td><%= link_to 'Show', project %></td>
        <td><%= link_to 'Edit', edit_project_path(project) %></td>
        <td><%= link_to 'Destroy', project, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<br>
<div id="welcome-bar" class="bar-style bar-thin add-margin bold-bar">
  <span>Projects Map</span>
</div>
<div style='width: 999px; margin: 1px 0 0 1px;'>
  <div id="map" style='width: 100%; height: 400px;'></div>
</div>

<script>

  handler = Gmaps.build('Google');
  handler.buildMap({ 
    internal: { id: 'map'},
    provider: {
      zoom:      10,
      center:    new google.maps.LatLng(52.0340465, -0.5985595),
      mapTypeId: google.maps.MapTypeId.ROADMAP,
    }
  },
  function(){
    markerHQ = handler.addMarkers([
      { lat: 52.052839, lng: -0.440285, "picture": {
          "url": "<%= asset_path('HQ_marker.png') %>",
          "width":  26,
          "height": 43 
        },
      },
      { lat: 52.034734, lng: -0.596872, "picture": {
          "url": "<%= asset_path('HQ_marker.png') %>",
          "width":  26,
          "height": 43 
        },
      }
    ]);
    markers1 = handler.addMarkers(<%=raw @enq_hash.to_json %>); 
    markers2 = handler.addMarkers(<%=raw @quoting_hash.to_json %>); 
    handler.bounds.extendWith();
    handler.fitMapToBounds();
  });

</script>
